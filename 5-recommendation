import pandas as pd
from sklearn.feature_extraction.text import TfidfVectorizer
from sklearn.metrics.pairwise import cosine_similarity

df = pd.read_csv("data/processed/netflix_features.csv")
df = df[['title','listed_in','description']].dropna().reset_index(drop=True)

df['content'] = df['listed_in'] + " " + df['description']

tfidf = TfidfVectorizer(stop_words='english')
tfidf_matrix = tfidf.fit_transform(df['content'])
similarity = cosine_similarity(tfidf_matrix)

def recommend(title, n=5):
    title = title.lower().strip()
    df['title_lower'] = df['title'].str.lower().str.strip()

    if title not in df['title_lower'].values:
        return "Title not found in dataset"

    idx = df[df['title_lower'] == title].index[0]
    scores = list(enumerate(similarity[idx]))
    scores = sorted(scores, key=lambda x: x[1], reverse=True)[1:n+1]

    return [df.iloc[i[0]]['title'] for i in scores]

print(recommend("jaws"))
